# Production Environment Configuration
# Copy this file to .env.production and fill in actual values
# NEVER commit .env.production to version control

# Environment
NODE_ENV=production
# Used by compose.prod.yml to load runtime env vars. Update if you rename this file.
COMPOSE_ENV_FILE=.env.production

# Server
PORT=3000

# Database
# These credentials configure the Postgres container in compose.prod.yml.
# When DATABASE_URL is not set, compose.prod.yml will build the connection string
# automatically from the values below, pointing at the bundled "db" service.
POSTGRES_USER=starter
POSTGRES_PASSWORD=GENERATE_STRONG_DB_PASSWORD_HERE
POSTGRES_DB=starter
# Override the default only when targeting an external Postgres instance.
DATABASE_URL=postgresql://starter:GENERATE_STRONG_DB_PASSWORD_HERE@db:5432/starter?schema=public

# Observability
LOG_LEVEL=info
METRICS_ENABLED=false
# To enable metrics in production, pick ONE guard mode below and uncomment it.
# Option A: Shared secret (recommended when scraping over private network)
# METRICS_GUARD=secret
# METRICS_GUARD_SECRET=GENERATE_STRONG_SECRET_HERE
# Option B: CIDR allowlist (restricts by IP ranges)
# METRICS_GUARD=cidr
# METRICS_GUARD_ALLOWLIST=10.0.0.0/8,172.16.0.0/12

# JWT
# CRITICAL: Generate strong random secrets (min 32 chars)
# Example: openssl rand -base64 32
JWT_ACCESS_SECRET=GENERATE_STRONG_SECRET_HERE
JWT_REFRESH_SECRET=GENERATE_STRONG_SECRET_HERE
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d

# Auth
AUTH_EMAIL_VERIFICATION_REQUIRED=true
AUTH_EMAIL_VERIFICATION_TTL_MINUTES=60
AUTH_PASSWORD_RESET_TTL_MINUTES=30
AUTH_LOGIN_MAX_ATTEMPTS=5
AUTH_LOGIN_LOCKOUT_MINUTES=15
AUTH_LOGIN_ATTEMPT_WINDOW_MINUTES=15

# Sessions
SESSION_CLEANUP_INTERVAL_MINUTES=60

# CORS
# List your production frontend URLs
CORS_ORIGINS=https://app.yourdomain.com,https://admin.yourdomain.com

# Redis / Rate limiting
# REDIS_PASSWORD secures the bundled Redis service; rotate it like any other secret.
REDIS_PASSWORD=GENERATE_STRONG_REDIS_PASSWORD_HERE
# RATE_LIMIT_REDIS_URL defaults to redis://:<REDIS_PASSWORD>@redis:6379/0 when unset.
# Override it when pointing at managed Redis or a different database index.
# RATE_LIMIT_REDIS_URL=redis://:GENERATE_STRONG_REDIS_PASSWORD_HERE@redis-host:6379/0
RATE_LIMIT_RPM=600
RATE_LIMIT_RPM_AUTH=120
RATE_LIMIT_WINDOW_SEC=900
# Required in production - use Redis for distributed rate limiting
RATE_LIMIT_REDIS_URL=redis://:GENERATE_STRONG_REDIS_PASSWORD_HERE@redis:6379/0

# Response compression
RESPONSE_COMPRESSION_ENABLED=true
RESPONSE_COMPRESSION_MIN_BYTES=1024

# Request parsing + server timeouts
REQUEST_BODY_LIMIT=100kb
HTTP_SERVER_REQUEST_TIMEOUT_MS=30000
HTTP_SERVER_HEADERS_TIMEOUT_MS=60000
HTTP_SERVER_KEEPALIVE_TIMEOUT_MS=5000
